#!/usr/local/bin/php -f
<?php

// SnG Example

namespace RPurinton\poker;

require_once(__DIR__ . '/vendor/autoload.php');

$build_info = json_decode(file_get_contents('build_info.json'), true);
echo ("poker (cli) v" . $build_info["number"] . " (built: " . $build_info["date"] . ")\n");

require_once('src/Casino.php');
$casino = new Casino("My Casino");

$player_names = [
    "Lily",
    "Adam",
    "Bella",
    "Ursula",
    "Finley",
    "Stella",
    "Derek",
    "Max",
    "Frank"
];

$tournament_blinds = [
    [10, 20],
    [15, 30],
    [20, 40],
    [25, 50],
    [30, 60],
    [40, 80],
    [50, 100],
    [60, 120],
    [75, 150],
    [100, 200],
    [125, 250],
    [150, 300],
    [200, 400],
    [250, 500]
];

$table = $casino->add_table(new Table([
    "id" => 1,
    "name" => "SnG 1",
    "seats" => 6,
    "minBuyIn" => 1500,
    "maxBuyIn" => 1500,
]));

for ($i = 0; $i < $table->config["seats"]; $i++) {
    $players[$i] = $casino->add_player(new Player($player_names[$i], PlayerType::AI));
    $casino->buy_chips($players[$i], 1500);
    $table->seat_player($players[$i], $table->seats[$i + 1])->buy_chips(1500);
}

$blind_index = -1;
while (true) {
    $blind_index++;
    if ($blind_index > count($tournament_blinds) - 1) $blind_index = count($tournament_blinds) - 1;
    // blinds go up each 9 hands
    for ($hands = 0; $hands < 9; $hands++) {
        $table->config["smallBlind"] = $tournament_blinds[$blind_index][0];
        $table->config["bigBlind"] = $tournament_blinds[$blind_index][1];
        $table->new_hand();
    }
}
